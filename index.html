<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>We're Still Marching â€” Minimal Marker Test</title>
    <!-- iOS safe area + cover -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover"/>

    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <!-- AR.js (A-Frame build) -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.3.2/aframe/build/aframe-ar.min.js"></script>

    <style>
      :root{
        /* iOS safe areas */
        --s-top: env(safe-area-inset-top);
        --s-right: env(safe-area-inset-right);
        --s-bottom: env(safe-area-inset-bottom);
        --s-left: env(safe-area-inset-left);
      }
      html, body {
        margin: 0; height: 100%;
        background: #000; color: #fff; font-family: Arial, sans-serif;
      }
      body { padding: var(--s-top) var(--s-right) var(--s-bottom) var(--s-left); }

      /* ðŸ”§ Make AR.js camera video & canvas fill the screen on iPhone */
      video#arjs-video, video.arjs-video, video[playsinline],
      canvas.a-canvas, .a-canvas canvas, a-scene {
        position: fixed !important;
        top: 0; left: 0;
        width: 100% !important; height: 100% !important;
        object-fit: cover;
      }

      /* Minimal start overlay so Safari gives us camera permission cleanly */
      #start {
        position: fixed; inset: 0;
        display: flex; align-items: center; justify-content: center;
        background: rgba(0,0,0,0.85); color: #fff; z-index: 9999;
        flex-direction: column; gap: 12px; text-align: center; padding: 24px;
      }
      #start button {
        padding: 12px 22px; font-size: 18px; border-radius: 8px;
        border: none; background:#ff6b6b; color:#fff; cursor: pointer;
      }
    </style>
  </head>

  <body>
    <div id="start">
      <h2>We're Still Marching â€” Camera Test</h2>
      <button id="go">Start</button>
      <div>Tap Start, allow camera, then point at the printed <b>HIRO</b> marker.</div>
    </div>

    <a-scene
      embedded
      vr-mode-ui="enabled: false"
      renderer="antialias:true"
      arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best; patternRatio: 0.9">

      <!-- HIRO marker with a simple box to prove tracking -->
      <a-marker preset="hiro" emitevents="true">
        <a-box color="#FF6B6B" depth="0.5" height="0.5" width="0.5" position="0 0.25 0" rotation="-90 0 0"></a-box>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      // Simple gate so user taps first (Safari likes a gesture before camera/audio)
      document.getElementById('go').addEventListener('click', () => {
        document.getElementById('start').style.display = 'none';
      });
    </script>
  </body>
</html>
