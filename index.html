<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>We’re Still Marching — Thembeka Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />

  <!-- A-Frame (matching a setup known to work well on iOS) -->
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <!-- AR.js for A-Frame -->
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

  <style>
    html, body { margin:0; height:100%; background:#000; font-family: Arial, sans-serif; }

    /* Make the AR camera fill the screen and crop correctly */
    video#arjs-video {
      position: fixed !important;
      top: 0; left: 0;
      width: 100vw !important;
      height: 100vh !important;
      object-fit: cover !important;
      z-index: 0;
      background: #000;
    }
    canvas.a-canvas, a-scene, .a-canvas {
      width: 100vw !important;
      height: 100vh !important;
      position: fixed !important;
      inset: 0;
    }

    /* simple UI overlay */
    #ui {
      position: absolute; z-index: 10; top: 12px; left: 12px;
      background: rgba(255,255,255,0.92); color:#111; padding:8px 10px; border-radius:6px;
      font-size: 14px; max-width: 80vw;
    }
    #start {
      margin-top: 8px;
      padding: 8px 12px; font-size: 14px;
      border: 0; border-radius: 6px; background: #ff6b6b; color: #fff;
    }
  </style>
</head>
<body>
  <div id="ui">
    1) Tap “Start” to enable audio<br>
    2) Point at the printed <b>HIRO</b> marker<br>
    3) Move closer/further to check size
    <div><button id="start">Start</button></div>
  </div>

  <a-scene
    embedded
    vr-mode-ui="enabled: false"
    renderer="antialias:true; alpha:true"
    arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best; patternRatio: 0.9">
    <a-assets>
      <!-- Use a video instead of GIF for reliable animation -->
      <video id="thembekaVideo"
             src="assets/thembeka.webm"
             preload="auto" loop playsinline webkit-playsinline crossorigin="anonymous">
      </video>
      <audio id="thembekaAudio"
             src="assets/thembeka.mp3"
             preload="auto" playsinline webkit-playsinline>
      </audio>
    </a-assets>

    <!-- Marker: HIRO -->
    <a-marker preset="hiro" id="marker-thembeka" emitevents="true">
      <!-- Optional: ambient light (safe even for 2D/video) -->
      <a-entity light="type: ambient; intensity: 1"></a-entity>

      <!-- Stand the character UP like a poster: rotation 0 0 0, above the marker at y ~0.6 -->
      <!-- Adjust width/height to taste; they’re in meters in AR world space -->
      <a-video id="thembekaPlane"
               src="#thembekaVideo"
               position="0 0.6 0"
               rotation="0 0 0"
               width="0.8" height="1.2"
               visible="true">
      </a-video>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    const startBtn   = document.querySelector('#start');
    const audio      = document.querySelector('#thembekaAudio');
    const video      = document.querySelector('#thembekaVideo');
    const marker     = document.querySelector('#marker-thembeka');

    // iOS needs a user gesture to unlock media playback:
    startBtn.addEventListener('click', async () => {
      try {
        await audio.play();  audio.pause();  audio.currentTime = 0;
        await video.play();  video.pause();  video.currentTime = 0;
      } catch(e) { /* ignore */ }
      startBtn.disabled = true;
      startBtn.textContent = 'Ready';
    });

    marker.addEventListener('markerFound', () => {
      // Try to play both when the marker is seen
      video.play().catch(()=>{});
      audio.play().catch(()=>{});
    });

    marker.addEventListener('markerLost', () => {
      // Stop + reset when the marker is lost
      if (!video.paused) { video.pause(); }
      video.currentTime = 0;
      if (!audio.paused) { audio.pause(); }
      audio.currentTime = 0;
    });
  </script>
</body>
</html>
