<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>HIRO — Visible Cube (Layer Fix)</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />

<!-- A-Frame + AR.js -->
<script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.3.2/aframe/build/aframe-ar.min.js"></script>

<style>
  html, body {
    margin:0; height:100%; width:100%;
    overflow:hidden; background:#000; font-family:system-ui, Arial, sans-serif;
  }

  /* Camera video BELOW canvas and slightly overscanned to kill right-edge seam */
  video#arjs-video, video.arjs-video, video[playsinline]{
    position:fixed !important;
    top:0; left:-3px;                               /* small overscan */
    width:calc(100vw + 6px) !important;             /* small overscan */
    height:100vh !important;
    object-fit:cover !important;
    z-index: 0 !important;                          /* BELOW canvas */
    background:#000;
    pointer-events:none;
  }

  /* WebGL canvas ABOVE video (very high z-index so it never hides) */
  canvas.a-canvas, .a-canvas canvas{
    position:fixed !important;
    top:0; left:-3px;                                /* match overscan */
    width:calc(100vw + 6px) !important;
    height:100vh !important;
    z-index: 9999 !important;                        /* way above */
    display:block !important;
    pointer-events:none;
  }

  a-scene{
    position:fixed !important;
    inset:0 !important;
    width:100vw !important;
    height:100vh !important;
  }

  #status{
    position:fixed; left:8px; bottom:8px; z-index:10000;
    background:rgba(0,0,0,.6); color:#0f0;
    font:12px/1.3 monospace; padding:6px 8px; border-radius:6px;
  }
</style>
</head>
<body>
  <div id="status">loading…</div>

  <a-scene
    embedded
    vr-mode-ui="enabled:false"
    renderer="antialias:true; alpha:true; precision:mediump"
    arjs="
      sourceType: webcam;
      facingMode: environment;
      detectionMode: mono;
      patternRatio: 0.5;
      debugUIEnabled: false
    "
  >
    <!-- DIRECT HIRO pattern (no preset). You don't need to host anything extra. -->
    <a-marker
      id="marker"
      type="pattern"
      emitevents="true"
      minConfidence="0.1"
      url="https://raw.githubusercontent.com/jeromeetienne/AR.js/master/three.js/examples/marker-training/examples/pattern-files/pattern-hiro.patt"
    >
      <!-- HUGE, unlit magenta cube (impossible to miss) -->
      <a-box id="probeCube"
             position="0 1 0"              <!-- sits 1 unit above marker -->
             width="2" height="2" depth="2" <!-- very large -->
             material="color:#FF00FF; shader:flat"
             visible="false"></a-box>

      <!-- Big flat white plane lying on the marker (also unlit) -->
      <a-plane id="probePlane"
               rotation="-90 0 0"          <!-- lie flat on marker -->
               position="0 0 0"
               width="2" height="2"
               material="color:#FFFFFF; shader:flat; opacity:0.9"
               visible="false"></a-plane>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    const statusEl   = document.getElementById('status');
    const marker     = document.getElementById('marker');
    const probeCube  = document.getElementById('probeCube');
    const probePlane = document.getElementById('probePlane');

    window.addEventListener('load', () => {
      statusEl.textContent = 'Point at your PRINTED HIRO (fill ~1/3 of screen, hold steady)…';
    });

    marker.addEventListener('markerFound', () => {
      probeCube.setAttribute('visible', 'true');
      probePlane.setAttribute('visible', 'true');
      statusEl.textContent = 'HIRO FOUND ✅ (visuals shown)';
    });

    marker.addEventListener('markerLost', () => {
      probeCube.setAttribute('visible', 'false');
      probePlane.setAttribute('visible', 'false');
      statusEl.textContent = 'Point at your PRINTED HIRO…';
    });
  </script>
</body>
</html>
